<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#080808">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>Essenza — Restoran</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Cinzel:wght@400;600&family=Jost:wght@300;400&display=swap" rel="stylesheet">
<script src="menu-data.js"></script>
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --black: #080808; --dark: #0f0f0f; --card: #141414;
  --border: rgba(193,160,98,0.18); --gold: #C1A062;
  --gold-light: #e8d4a8; --gold-dim: rgba(193,160,98,0.5);
  --white: #f5f0e8; --muted: rgba(245,240,232,0.45);
}
html { scroll-behavior: smooth; }
body { background: var(--black); color: var(--white); font-family: 'Jost', sans-serif; font-weight: 300; min-height: 100vh; overflow-x: hidden; }

/* ── INTRO SCREEN ──────────────────────────────────────────────────────── */
.intro {
  position: fixed; inset: 0; z-index: 9999;
  background: var(--black);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 0;
  pointer-events: none;
}
.intro.hide {
  animation: introFadeOut .8s ease .2s forwards;
}
@keyframes introFadeOut {
  to { opacity: 0; visibility: hidden; }
}

.intro-logo {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(56px, 14vw, 110px);
  font-weight: 300;
  letter-spacing: 16px;
  color: var(--white);
  opacity: 0;
  transform: scale(0.88);
  animation: introLogoIn 1.2s cubic-bezier(0.16,1,0.3,1) .1s forwards;
}
.intro-logo span { font-style: italic; color: var(--gold); }

@keyframes introLogoIn {
  to { opacity: 1; transform: scale(1); }
}

.intro-line {
  width: 0px;
  height: 1px;
  background: linear-gradient(to right, transparent, var(--gold), transparent);
  margin-top: 20px;
  animation: introLineExpand .9s ease .9s forwards;
}
@keyframes introLineExpand {
  to { width: 120px; }
}

.intro-sub {
  font-family: 'Cinzel', serif;
  font-size: 9px;
  letter-spacing: 5px;
  color: var(--gold-dim);
  text-transform: uppercase;
  margin-top: 18px;
  opacity: 0;
  animation: introSubIn .8s ease 1.3s forwards;
}
@keyframes introSubIn {
  to { opacity: 1; }
}

.intro-stars {
  margin-top: 28px;
  color: var(--gold);
  font-size: 11px;
  letter-spacing: 8px;
  opacity: 0;
  animation: introSubIn .8s ease 1.6s forwards;
}

/* HERO */
.hero { position: relative; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; overflow: hidden; }
.hero::before { content: ''; position: absolute; inset: 0; background: radial-gradient(ellipse 60% 50% at 50% 40%, rgba(193,160,98,0.07) 0%, transparent 70%); }
.hero-ornament { position: absolute; top:0;left:0;right:0;bottom:0; pointer-events: none; overflow: hidden; }
.hero-ornament::before, .hero-ornament::after { content:''; position:absolute; border:1px solid rgba(193,160,98,0.12); border-radius:50%; }
.hero-ornament::before { width:600px;height:600px;top:50%;left:50%;transform:translate(-50%,-50%);animation:pulse-ring 6s ease-in-out infinite; }
.hero-ornament::after { width:800px;height:800px;top:50%;left:50%;transform:translate(-50%,-50%);animation:pulse-ring 6s ease-in-out infinite 1.5s; }
@keyframes pulse-ring { 0%,100%{opacity:.4;transform:translate(-50%,-50%) scale(1)}50%{opacity:.1;transform:translate(-50%,-50%) scale(1.03)} }
.hero-stars { position:absolute;top:40px;left:0;right:0;display:flex;justify-content:center;align-items:center;gap:8px;animation:fadeSlideDown 1.2s ease forwards;opacity:0; }
.hero-eyebrow { font-family:'Cinzel',serif;font-size:10px;letter-spacing:6px;color:var(--gold-dim);text-transform:uppercase;margin-bottom:24px;animation:fadeSlideDown 1s ease .3s forwards;opacity:0; }
.hero-title { font-family:'Cormorant Garamond',serif;font-size:clamp(72px,14vw,140px);font-weight:300;letter-spacing:12px;line-height:1;animation:fadeSlideUp 1.2s ease .5s forwards;opacity:0; }
.hero-title span { font-style:italic;color:var(--gold); }
.hero-sub { font-family:'Cinzel',serif;font-size:11px;letter-spacing:5px;color:var(--muted);margin-top:20px;animation:fadeSlideUp 1.2s ease .8s forwards;opacity:0; }
.scroll-hint { position:absolute;bottom:40px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:8px;animation:fadeSlideUp 1.2s ease 1.4s forwards;opacity:0;cursor:pointer; }
.scroll-hint span { font-family:'Cinzel',serif;font-size:9px;letter-spacing:4px;color:var(--gold-dim); }
.scroll-line { width:1px;height:40px;background:linear-gradient(to bottom,var(--gold-dim),transparent);animation:scroll-pulse 2s ease-in-out infinite; }
@keyframes scroll-pulse { 0%,100%{opacity:1}50%{opacity:.3} }
@keyframes fadeSlideDown { from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)} }
@keyframes fadeSlideUp { from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)} }

/* NAV */
.nav { position:sticky;top:0;z-index:100;background:rgba(8,8,8,0.92);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 24px;overflow-x:auto;scrollbar-width:none; }
.nav::-webkit-scrollbar { display:none; }
.nav-inner { display:flex;align-items:center;justify-content:center;gap:0;min-width:max-content;margin:0 auto; }
.nav-btn { font-family:'Cinzel',serif;font-size:9px;letter-spacing:3px;color:var(--muted);background:none;border:none;padding:20px 22px;cursor:pointer;text-transform:uppercase;transition:color .3s;white-space:nowrap;position:relative; }
.nav-btn::after { content:'';position:absolute;bottom:0;left:50%;right:50%;height:1px;background:var(--gold);transition:left .3s,right .3s; }
.nav-btn:hover, .nav-btn.active { color:var(--gold); }
.nav-btn.active::after { left:16px;right:16px; }
.nav-dot { color:var(--border);font-size:8px;padding:0 4px; }

/* SECTIONS */
.section { max-width:860px;margin:0 auto;padding:80px 24px;opacity:0;transform:translateY(30px);transition:opacity .8s ease,transform .8s ease; }
.section.visible { opacity:1;transform:translateY(0); }
.section-header { text-align:center;margin-bottom:60px; }
.section-label { font-family:'Cinzel',serif;font-size:9px;letter-spacing:5px;color:var(--gold-dim);text-transform:uppercase;margin-bottom:16px;display:block; }
.section-title { font-family:'Cormorant Garamond',serif;font-size:clamp(36px,7vw,60px);font-weight:300;font-style:italic;color:var(--white);line-height:1.1; }
.section-line { width:120px;height:1px;background:linear-gradient(to right,transparent,var(--gold),transparent);margin:24px auto 0;display:block; }
.hero-divider { width:120px;height:1px;background:linear-gradient(to right,transparent,var(--gold),transparent);margin:28px auto 0;animation:fadeSlideUp 1.2s ease 1s forwards;opacity:0; }

/* DEGU */
.degu-card { position:relative;border:1px solid var(--border);padding:48px;background:var(--card);overflow:hidden; }
.degu-card::before { content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(to right,transparent,var(--gold),transparent); }
.degu-card::after { content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 40% at 50% 0%,rgba(193,160,98,0.04) 0%,transparent 70%);pointer-events:none; }
.degu-badge { display:inline-flex;align-items:center;gap:8px;border:1px solid var(--gold-dim);padding:6px 16px;margin-bottom:28px; }
.degu-badge span { font-family:'Cinzel',serif;font-size:8px;letter-spacing:4px;color:var(--gold);text-transform:uppercase; }
.degu-name { font-family:'Cormorant Garamond',serif;font-size:42px;font-weight:300;font-style:italic;color:var(--white);margin-bottom:8px; }
.degu-sub { font-family:'Cinzel',serif;font-size:9px;letter-spacing:3px;color:var(--muted);text-transform:uppercase;margin-bottom:36px; }
.degu-courses { display:flex;flex-direction:column;gap:0;border-left:1px solid var(--border);padding-left:28px;margin-bottom:36px; }
.degu-course { display:flex;gap:20px;padding:16px 0;border-bottom:1px solid rgba(193,160,98,0.07);position:relative; }
.degu-course::before { content:'';position:absolute;left:-32px;top:50%;width:7px;height:7px;border:1px solid var(--gold-dim);background:var(--card);transform:translateY(-50%) rotate(45deg); }
.course-num { font-family:'Cinzel',serif;font-size:9px;letter-spacing:2px;color:var(--gold-dim);width:24px;flex-shrink:0;padding-top:2px; }
.course-info { flex:1; }
.course-name { font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:400;color:var(--white);margin-bottom:3px; }
.course-desc { font-size:12px;color:var(--muted);line-height:1.6;letter-spacing:.3px; }
.degu-footer { display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px; }
.degu-price { font-family:'Cormorant Garamond',serif;font-size:36px;font-weight:300;color:var(--gold); }
.degu-price sup { font-size:16px;vertical-align:super;margin-right:2px; }
.pairing-btn { font-family:'Cinzel',serif;font-size:9px;letter-spacing:3px;color:var(--gold);text-transform:uppercase;background:none;border:1px solid var(--gold-dim);padding:12px 24px;cursor:pointer;transition:background .3s,color .3s; }
.pairing-btn:hover { background:var(--gold);color:var(--black); }

/* MENU */
.menu-grid { display:flex;flex-direction:column; }
.menu-item { display:grid;grid-template-columns:1fr auto;gap:24px;align-items:start;padding:28px 0;border-bottom:1px solid rgba(193,160,98,0.08);transition:background .2s; }
.menu-item:hover { background:rgba(193,160,98,0.02); }
.item-name { font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:400;color:var(--white);margin-bottom:6px;line-height:1.2; }
.item-name em { font-style:italic;color:var(--gold-light);font-size:.85em; }
.item-desc { font-size:12px;color:var(--muted);line-height:1.7;letter-spacing:.3px;max-width:480px; }
.item-tags { display:flex;gap:6px;margin-top:10px;flex-wrap:wrap; }
.tag { font-family:'Cinzel',serif;font-size:7px;letter-spacing:2px;color:var(--gold-dim);border:1px solid rgba(193,160,98,0.2);padding:3px 8px;text-transform:uppercase; }
.item-price { font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:300;color:var(--gold);white-space:nowrap;text-align:right; }

/* WINE */
.wine-category { margin-bottom:48px; }
.wine-cat-title { font-family:'Cinzel',serif;font-size:9px;letter-spacing:5px;color:var(--gold);text-transform:uppercase;padding:12px 0;border-bottom:1px solid var(--border);margin-bottom:0; }
.wine-item { display:grid;grid-template-columns:1fr auto;gap:24px;padding:22px 0;border-bottom:1px solid rgba(193,160,98,0.07);align-items:center;transition:background .2s; }
.wine-item:hover { background:rgba(193,160,98,0.02); }
.wine-name { font-family:'Cormorant Garamond',serif;font-size:19px;font-weight:400;color:var(--white);margin-bottom:3px; }
.wine-info { font-size:11px;color:var(--muted);letter-spacing:.5px; }
.wine-prices { text-align:right; }
.wine-prices .glass { font-family:'Cormorant Garamond',serif;font-size:16px;color:var(--gold-dim);margin-bottom:2px; }
.wine-prices .bottle { font-family:'Cormorant Garamond',serif;font-size:20px;color:var(--gold); }

/* FOOTER */
.footer { border-top:1px solid var(--border);padding:60px 24px;text-align:center; }
.footer-logo { font-family:'Cormorant Garamond',serif;font-size:28px;font-style:italic;font-weight:300;color:var(--gold);letter-spacing:6px;margin-bottom:12px; }
.footer-addr { font-size:11px;color:var(--muted);letter-spacing:2px;line-height:1.8; }
.footer-stars { color:var(--gold);font-size:12px;letter-spacing:6px;margin:20px 0; }

/* SEP */
.sep { display:flex;align-items:center;gap:16px;max-width:860px;margin:0 auto;padding:0 24px;opacity:.3; }
.sep-line { flex:1;height:1px;background:var(--gold); }
.sep-diamond { color:var(--gold);font-size:8px; }

/* ADMIN TRIGGER */
.admin-trigger { position:fixed;bottom:20px;right:20px;width:44px;height:44px;background:rgba(8,8,8,0.6);border:1px solid rgba(193,160,98,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:999;transition:border-color .3s,background .3s; }
.admin-trigger:hover { border-color:var(--gold-dim);background:rgba(20,20,20,0.9); }
.admin-trigger svg { width:16px;height:16px;stroke:var(--gold-dim);fill:none;stroke-width:1.5; }

/* LOGIN MODAL */
.modal-overlay { position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);z-index:1000;display:none;align-items:center;justify-content:center; }
.modal-overlay.open { display:flex; }
.login-modal { background:var(--card);border:1px solid var(--border);padding:48px;width:100%;max-width:380px;position:relative; }
.login-modal::before { content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(to right,transparent,var(--gold),transparent); }
.modal-title { font-family:'Cormorant Garamond',serif;font-size:28px;font-style:italic;font-weight:300;color:var(--white);margin-bottom:6px; }
.modal-sub { font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;color:var(--muted);text-transform:uppercase;margin-bottom:32px; }
.modal-input { width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--border);color:var(--white);font-family:'Jost',sans-serif;font-size:14px;font-weight:300;padding:14px 16px;outline:none;transition:border-color .3s;letter-spacing:2px; }
.modal-input:focus { border-color:var(--gold-dim); }
.modal-input::placeholder { color:var(--muted);letter-spacing:1px; }
.modal-btn { width:100%;margin-top:16px;background:transparent;border:1px solid var(--gold-dim);color:var(--gold);font-family:'Cinzel',serif;font-size:9px;letter-spacing:4px;text-transform:uppercase;padding:14px;cursor:pointer;transition:background .3s,color .3s; }
.modal-btn:hover { background:var(--gold);color:var(--black); }
.modal-error { font-size:11px;color:#e07070;margin-top:10px;letter-spacing:.5px;min-height:16px; }
.modal-close { position:absolute;top:16px;right:16px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:18px;line-height:1;transition:color .3s; }
.modal-close:hover { color:var(--white); }

/* ADMIN PANEL */
.admin-panel { position:fixed;inset:0;background:var(--black);z-index:2000;overflow-y:auto;display:none; }
.admin-panel.open { display:block; }
.admin-header { position:sticky;top:0;background:rgba(8,8,8,0.95);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 32px;display:flex;align-items:center;justify-content:space-between;z-index:10; }
.admin-logo { font-family:'Cormorant Garamond',serif;font-size:20px;font-style:italic;color:var(--gold);letter-spacing:4px;padding:18px 0; }
.admin-header-actions { display:flex;gap:12px;align-items:center; }
.admin-download { font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;background:none;border:1px solid var(--gold-dim);color:var(--gold);padding:10px 20px;cursor:pointer;text-transform:uppercase;transition:all .2s; }
.admin-download:hover { background:rgba(193,160,98,0.1); }
.admin-save-all { font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;background:var(--gold);color:var(--black);border:none;padding:10px 20px;cursor:pointer;text-transform:uppercase;transition:opacity .2s; }
.admin-save-all:hover { opacity:.85; }
.admin-close { font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;background:none;border:1px solid var(--border);color:var(--muted);padding:10px 20px;cursor:pointer;text-transform:uppercase;transition:color .3s,border-color .3s; }
.admin-close:hover { color:var(--white);border-color:var(--gold-dim); }

.admin-body { max-width:900px;margin:0 auto;padding:40px 32px; }

/* Admin tabs */
.admin-tabs { display:flex;gap:0;border-bottom:1px solid var(--border);margin-bottom:40px;overflow-x:auto;scrollbar-width:none; }
.admin-tabs::-webkit-scrollbar { display:none; }
.admin-tab { font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;color:var(--muted);background:none;border:none;border-bottom:2px solid transparent;padding:14px 20px;cursor:pointer;white-space:nowrap;text-transform:uppercase;transition:color .3s,border-color .3s;margin-bottom:-1px; }
.admin-tab:hover { color:var(--gold); }
.admin-tab.active { color:var(--gold);border-bottom-color:var(--gold); }

.admin-section { display:none; }
.admin-section.active { display:block; }

/* Admin fields */
.admin-group { margin-bottom:32px; }
.admin-group-title { font-family:'Cinzel',serif;font-size:8px;letter-spacing:4px;color:var(--gold-dim);text-transform:uppercase;margin-bottom:16px;padding-bottom:8px;border-bottom:1px solid var(--border); }
.field-row { display:grid;gap:12px;margin-bottom:12px; }
.field-row.cols-2 { grid-template-columns:1fr 1fr; }
.field-row.cols-3 { grid-template-columns:1fr 1fr 120px; }
.field-label { font-family:'Cinzel',serif;font-size:7px;letter-spacing:3px;color:var(--muted);text-transform:uppercase;margin-bottom:6px;display:block; }
.admin-input, .admin-textarea { width:100%;background:rgba(255,255,255,0.03);border:1px solid var(--border);color:var(--white);font-family:'Jost',sans-serif;font-size:13px;font-weight:300;padding:11px 14px;outline:none;transition:border-color .3s;resize:vertical; }
.admin-input:focus, .admin-textarea:focus { border-color:var(--gold-dim); }
.admin-textarea { min-height:70px;line-height:1.6; }

/* Card items */
.admin-card { background:var(--card);border:1px solid var(--border);padding:24px;margin-bottom:16px;position:relative; }
.admin-card-header { display:flex;align-items:center;justify-content:space-between;margin-bottom:16px; }
.admin-card-num { font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;color:var(--gold);text-transform:uppercase; }
.admin-card-actions { display:flex;gap:8px; }
.btn-del { font-family:'Cinzel',serif;font-size:7px;letter-spacing:2px;background:none;border:1px solid rgba(200,80,80,0.3);color:rgba(200,80,80,0.7);padding:6px 12px;cursor:pointer;text-transform:uppercase;transition:all .2s; }
.btn-del:hover { border-color:rgba(200,80,80,0.8);color:#e08080; }
.btn-add { display:flex;align-items:center;gap:8px;font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;background:none;border:1px dashed var(--gold-dim);color:var(--gold-dim);padding:14px 20px;cursor:pointer;text-transform:uppercase;transition:all .2s;width:100%;justify-content:center;margin-top:4px; }
.btn-add:hover { border-color:var(--gold);color:var(--gold); }

.cur-btn { font-family:'Cinzel',serif;font-size:9px;letter-spacing:2px;background:none;border:1px solid var(--border);color:var(--muted);padding:10px 16px;cursor:pointer;text-transform:uppercase;transition:all .2s; }
.cur-btn:hover { border-color:var(--gold-dim);color:var(--gold); }
.cur-btn.selected { border-color:var(--gold);color:var(--gold);background:rgba(193,160,98,0.08); }

/* BANNER */
.site-banner { background:rgba(193,160,98,0.08);border-top:1px solid var(--border);border-bottom:1px solid var(--border);padding:12px 24px;text-align:center;display:none; }
.site-banner.active { display:block; }
.site-banner-text { font-family:'Cinzel',serif;font-size:9px;letter-spacing:3px;color:var(--gold);text-transform:uppercase; }

/* REZERVASYON */
.reservation-btn { position:fixed;bottom:20px;left:20px;z-index:998;font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;background:var(--gold);color:var(--black);border:none;padding:13px 20px;cursor:pointer;text-transform:uppercase;transition:opacity .2s;display:none; }
.reservation-btn.active { display:block; }
.reservation-btn:hover { opacity:.85; }

/* MENU BADGES */
.badge-chef { display:inline-block;font-family:'Cinzel',serif;font-size:6px;letter-spacing:2px;color:var(--black);background:var(--gold);padding:2px 7px;text-transform:uppercase;margin-left:8px;vertical-align:middle;position:relative;top:-1px; }
.badge-v  { display:inline-block;width:16px;height:16px;border:1px solid rgba(120,180,80,0.6);border-radius:50%;font-size:8px;line-height:15px;text-align:center;color:rgba(120,180,80,0.8);margin-left:6px;vertical-align:middle; }
.badge-vg { display:inline-block;width:16px;height:16px;border:1px solid rgba(80,200,120,0.6);border-radius:50%;font-size:7px;line-height:15px;text-align:center;color:rgba(80,200,120,0.8);margin-left:6px;vertical-align:middle; }
.item-calories { font-size:10px;color:rgba(245,240,232,0.25);letter-spacing:1px;margin-top:4px; }
.item-allergens { font-size:10px;color:rgba(245,240,232,0.28);letter-spacing:.5px;margin-top:3px; }
.item-allergen-label { color:rgba(193,160,98,0.4);margin-right:4px; }

/* SOSYAL MEDYA */
.footer-socials { display:flex;justify-content:center;gap:20px;margin-top:16px; }
.footer-social-link { font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;color:var(--gold-dim);text-decoration:none;text-transform:uppercase;transition:color .2s; }
.footer-social-link:hover { color:var(--gold); }

/* TOGGLE SWITCH admin */
.toggle-row { display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(193,160,98,0.07); }
.toggle-row:last-child { border-bottom:none; }
.toggle-label { font-family:'Jost',sans-serif;font-size:13px;font-weight:300;color:var(--white); }
.toggle-desc { font-size:11px;color:var(--muted);margin-top:2px; }
.toggle-switch { position:relative;width:44px;height:24px;flex-shrink:0; }
.toggle-switch input { opacity:0;width:0;height:0; }
.toggle-slider { position:absolute;inset:0;background:rgba(255,255,255,0.08);border:1px solid var(--border);cursor:pointer;transition:.3s;border-radius:24px; }
.toggle-slider::before { content:'';position:absolute;width:16px;height:16px;left:3px;bottom:3px;background:var(--muted);transition:.3s;border-radius:50%; }
.toggle-switch input:checked + .toggle-slider { background:rgba(193,160,98,0.15);border-color:var(--gold-dim); }
.toggle-switch input:checked + .toggle-slider::before { transform:translateX(20px);background:var(--gold); }

.toast { position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--card);border:1px solid var(--gold-dim);padding:14px 28px;font-family:'Cinzel',serif;font-size:9px;letter-spacing:3px;color:var(--gold);text-transform:uppercase;opacity:0;transition:all .4s;z-index:9999;white-space:nowrap; }
.toast.show { opacity:1;transform:translateX(-50%) translateY(0); }

/* PAIRING MODAL */
.pairing-overlay { position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(12px);z-index:1500;display:none;align-items:flex-start;justify-content:center;padding:40px 20px;overflow-y:auto; }
.pairing-overlay.open { display:flex; }
.pairing-modal { background:var(--dark);border:1px solid var(--border);width:100%;max-width:680px;position:relative;animation:fadeSlideUp .4s ease forwards; }
.pairing-modal::before { content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(to right,transparent,var(--gold),transparent); }
.pairing-modal-header { padding:36px 40px 24px;border-bottom:1px solid var(--border);display:flex;align-items:flex-start;justify-content:space-between;gap:16px; }
.pairing-modal-title { font-family:'Cormorant Garamond',serif;font-size:32px;font-style:italic;font-weight:300;color:var(--white);margin-bottom:4px; }
.pairing-modal-sub { font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;color:var(--gold-dim);text-transform:uppercase; }
.pairing-modal-close { background:none;border:1px solid var(--border);color:var(--muted);width:36px;height:36px;cursor:pointer;font-size:16px;flex-shrink:0;transition:all .2s;display:flex;align-items:center;justify-content:center; }
.pairing-modal-close:hover { border-color:var(--gold-dim);color:var(--white); }
.pairing-modal-body { padding:32px 40px; }
.pairing-loading { display:flex;flex-direction:column;align-items:center;gap:20px;padding:40px 0; }
.pairing-spinner { width:40px;height:40px;border:1px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }
.pairing-loading-text { font-family:'Cinzel',serif;font-size:8px;letter-spacing:4px;color:var(--gold-dim);text-transform:uppercase; }
.pairing-courses { display:flex;flex-direction:column;gap:0; }
.pairing-course-card { padding:24px 0;border-bottom:1px solid rgba(193,160,98,0.08);opacity:0;animation:fadeSlideUp .5s ease forwards; }
.pairing-course-card:last-child { border-bottom:none; }
.pairing-course-header { display:flex;align-items:baseline;gap:12px;margin-bottom:10px; }
.pairing-course-num { font-family:'Cinzel',serif;font-size:8px;letter-spacing:2px;color:var(--gold-dim); }
.pairing-course-name { font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:400;color:var(--white); }
.pairing-wine-name { font-family:'Cormorant Garamond',serif;font-size:15px;font-style:italic;color:var(--gold-light);margin-bottom:5px; }
.pairing-wine-reason { font-size:12px;color:var(--muted);line-height:1.7;letter-spacing:.3px; }
.pairing-external-note { font-size:11px;color:rgba(193,160,98,0.35);font-style:italic;margin-top:4px; }
.pairing-error { text-align:center;padding:40px 0;color:var(--muted);font-size:13px;line-height:1.7; }

@media(max-width:600px){
  /* Menü */
  .degu-card{padding:24px 16px}
  .degu-name{font-size:28px}
  .degu-footer{flex-direction:column;align-items:flex-start}
  .pairing-btn{width:100%;text-align:center;justify-content:center}
  .menu-item{padding:20px 0;gap:10px}
  .item-name{font-size:18px}
  .item-price{font-size:18px}
  .wine-item{grid-template-columns:1fr;gap:6px}
  .wine-prices{text-align:left}
  .nav-btn{padding:16px 12px;font-size:8px;letter-spacing:2px}
  .hero-title{letter-spacing:4px}
  .section{padding:56px 16px}
  /* Pairing modal */
  .pairing-overlay{padding:0}
  .pairing-modal{min-height:100dvh;border:none;border-radius:0}
  .pairing-modal-header{padding:24px 20px 16px}
  .pairing-modal-title{font-size:24px}
  .pairing-modal-body{padding:20px}
  /* Admin genel */
  .admin-body{padding:16px 12px}
  .admin-header{padding:0 16px}
  .admin-logo{font-size:16px;letter-spacing:2px}
  .admin-save-all,.admin-close{padding:8px 12px;font-size:7px;letter-spacing:2px}
  .admin-tabs{padding:0 4px}
  .admin-tab{padding:12px 10px;font-size:7px;letter-spacing:2px}
  .admin-card{padding:16px 12px}
  .field-row.cols-2,.field-row.cols-3{grid-template-columns:1fr}
  .admin-input,.admin-textarea{font-size:16px} /* iOS zoom önleme */
  /* Login modal */
  .login-modal{padding:32px 20px;margin:20px}
  .modal-input{font-size:16px} /* iOS zoom önleme */
  /* Admin trigger daha büyük - dokunması kolay */
  .admin-trigger{width:52px;height:52px;bottom:16px;right:16px}
}
</style>
</head>
<body>

<!-- INTRO SCREEN -->
<div class="intro" id="introScreen">
  <div class="intro-logo"><span>Es</span>senza</div>
  <div class="intro-line"></div>
  <div class="intro-sub">Restaurant</div>
  <div class="intro-stars">✦ &nbsp; ✦ &nbsp; ✦</div>
</div>
<script>
// Intro dismiss — inline, fetch'ten bağımsız çalışır
(function(){
  function dismissIntro(){
    var intro = document.getElementById('introScreen');
    if(!intro || !intro.parentNode) return;
    intro.classList.add('hide');
    setTimeout(function(){ if(intro.parentNode) intro.remove(); }, 1000);
  }
  setTimeout(dismissIntro, 2400);
  setTimeout(dismissIntro, 5000); // güvenlik kilidi
  document.addEventListener('DOMContentLoaded', function(){
    var intro = document.getElementById('introScreen');
    if(intro) intro.addEventListener('click', dismissIntro);
  });
})();
</script>

<!-- HERO -->
<section class="hero" id="top">
  <div class="hero-ornament"></div>
  <div class="hero-stars"><span style="color:var(--gold);font-size:14px;letter-spacing:4px">✦ ✦ ✦</span></div>
  <p class="hero-eyebrow" id="d-eyebrow">Ristorante</p>
  <h1 class="hero-title" id="d-heroTitle"><span>Es</span>senza</h1>
  <p class="hero-sub" id="d-heroSub">Milano · Dal 2019</p>
  <div class="hero-divider"></div>
  <div class="scroll-hint" onclick="scrollToNav()">
    <span>Menü</span><div class="scroll-line"></div>
  </div>
</section>

<!-- BANNER -->
<div class="site-banner" id="siteBanner">
  <span class="site-banner-text" id="d-bannerText"></span>
</div>

<!-- NAV -->
<nav class="nav" id="menu-nav">
  <div class="nav-inner" id="d-navInner">
    <!-- rendered by JS -->
  </div>
</nav>

<!-- DEGU -->
<section class="section" id="degu">
  <div class="section-header">
    <span class="section-label" id="d-deguLabel">Esperienza Completa</span>
    <h2 class="section-title" id="d-deguTitle">Degustazione</h2>
    <div class="section-line"></div>
  </div>
  <div class="degu-card">
    <div class="degu-badge"><span id="d-deguBadge">★ Firma dello Chef ★</span></div>
    <div class="degu-name" id="d-deguName">Terra & Mare</div>
    <div class="degu-sub" id="d-deguSub">8 portate · Abbinamento vini disponibile</div>
    <div class="degu-courses" id="d-courses"></div>
    <div class="degu-footer">
      <div class="degu-price"><span id="d-deguPrice">240</span></div>
      <button class="pairing-btn" id="d-pairingBtn" onclick="openPairing()">+ Şarap Eşleştirme · €120</button>
    </div>
  </div>
</section>

<div class="sep"><div class="sep-line"></div><span class="sep-diamond">◆</span><div class="sep-line"></div></div>

<!-- ANTIPASTI -->
<section class="section" id="antipasti">
  <div class="section-header">
    <span class="section-label" id="d-antipastiLabel">Per Iniziare</span>
    <h2 class="section-title" id="d-antipastiTitle">Antipasti</h2>
    <div class="section-line"></div>
  </div>
  <div class="menu-grid" id="d-antipasti"></div>
</section>
<div class="sep"><div class="sep-line"></div><span class="sep-diamond">◆</span><div class="sep-line"></div></div>

<!-- PRIMI -->
<section class="section" id="primi">
  <div class="section-header">
    <span class="section-label" id="d-primiLabel">I Primi Piatti</span>
    <h2 class="section-title" id="d-primiTitle">Primi</h2>
    <div class="section-line"></div>
  </div>
  <div class="menu-grid" id="d-primi"></div>
</section>
<div class="sep"><div class="sep-line"></div><span class="sep-diamond">◆</span><div class="sep-line"></div></div>

<!-- SECONDI -->
<section class="section" id="secondi">
  <div class="section-header">
    <span class="section-label" id="d-secondiLabel">I Secondi Piatti</span>
    <h2 class="section-title" id="d-secondiTitle">Secondi</h2>
    <div class="section-line"></div>
  </div>
  <div class="menu-grid" id="d-secondi"></div>
</section>
<div class="sep"><div class="sep-line"></div><span class="sep-diamond">◆</span><div class="sep-line"></div></div>

<!-- DOLCI -->
<section class="section" id="dolci">
  <div class="section-header">
    <span class="section-label" id="d-dolciLabel">Fine Pasto</span>
    <h2 class="section-title" id="d-dolciTitle">Dolci</h2>
    <div class="section-line"></div>
  </div>
  <div class="menu-grid" id="d-dolci"></div>
</section>
<div class="sep"><div class="sep-line"></div><span class="sep-diamond">◆</span><div class="sep-line"></div></div>

<!-- VINI -->
<section class="section" id="vini">
  <div class="section-header">
    <span class="section-label" id="d-viniLabel">La Cantina</span>
    <h2 class="section-title" id="d-viniTitle">Vini</h2>
    <div class="section-line"></div>
  </div>
  <div id="d-vini"></div>
</section>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-logo" id="d-footerLogo">Essenza</div>
  <div class="footer-stars">✦ ✦ ✦</div>
  <div class="footer-socials" id="d-socials"></div>
  <div class="footer-addr" id="d-footerAddr">
    Via Monte Napoleone 12, Milano 20121<br>
    +39 02 1234 5678 · info@essenzaristorante.it<br><br>
    Aperto Martedì — Sabato · 19:30 – 23:00<br>
    Prenotazione obbligatoria
  </div>
</footer>

<!-- REZERVASYON BUTONU -->
<button class="reservation-btn" id="reservationBtn" onclick="openReservation()"></button>

<!-- PAIRING MODAL -->
<div class="pairing-overlay" id="pairingOverlay">
  <div class="pairing-modal">
    <div class="pairing-modal-header">
      <div>
        <div class="pairing-modal-title">Şarap Eşleştirme</div>
        <div class="pairing-modal-sub">Sommelier · Yapay Zeka Destekli</div>
      </div>
      <button class="pairing-modal-close" onclick="closePairing()">✕</button>
    </div>
    <div class="pairing-modal-body" id="pairingBody">
      <div class="pairing-loading">
        <div class="pairing-spinner"></div>
        <div class="pairing-loading-text">Eşleştirmeler hazırlanıyor...</div>
      </div>
    </div>
  </div>
</div>

<!-- ADMIN TRIGGER -->
<div class="admin-trigger" onclick="openLogin()" title="Yönetici Girişi">
  <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
</div>

<!-- LOGIN MODAL -->
<div class="modal-overlay" id="loginModal">
  <div class="login-modal">
    <button class="modal-close" onclick="closeLogin()">✕</button>
    <div class="modal-title">Yönetici Girişi</div>
    <div class="modal-sub">Yalnızca yetkili erişim</div>
    <input class="modal-input" type="password" id="pwInput" placeholder="Şifre" onkeydown="if(event.key==='Enter')checkPw()">
    <button class="modal-btn" onclick="checkPw()">Giriş Yap</button>
    <div class="modal-error" id="pwError"></div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="admin-panel" id="adminPanel">
  <div class="admin-header">
    <div class="admin-logo">Essenza · Yönetici</div>
    <div class="admin-header-actions">
      <button class="admin-save-all" onclick="saveAll()">Tümünü Kaydet</button>
      <button class="admin-close" onclick="closeAdmin()">✕ Kapat</button>
    </div>
  </div>

  <div class="admin-body">
    <!-- TABS -->
    <div class="admin-tabs">
      <button class="admin-tab active" onclick="switchTab('tab-generale')">Genel</button>
      <button class="admin-tab" onclick="switchTab('tab-gorunum')">Görünüm</button>
      <button class="admin-tab" onclick="switchTab('tab-degu')">Tadım Menüsü</button>
      <button class="admin-tab" onclick="switchTab('tab-antipasti')">Başlangıçlar</button>
      <button class="admin-tab" onclick="switchTab('tab-primi')">Birinci Yemekler</button>
      <button class="admin-tab" onclick="switchTab('tab-secondi')">Ana Yemekler</button>
      <button class="admin-tab" onclick="switchTab('tab-dolci')">Tatlılar</button>
      <button class="admin-tab" onclick="switchTab('tab-vini')">Şaraplar</button>
    </div>

    <!-- TAB: GENERALE -->
    <div class="admin-section active" id="tab-generale">
      <div class="admin-group">
        <div class="admin-group-title">Para Birimi</div>
        <div class="field-row">
          <div>
            <label class="field-label">Para Birimi Sembolü</label>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:4px;" id="a-currency-btns">
              <button class="cur-btn" data-cur="€" onclick="selectCur(this)">€ Euro</button>
              <button class="cur-btn" data-cur="$" onclick="selectCur(this)">$ Dolar</button>
              <button class="cur-btn" data-cur="₺" onclick="selectCur(this)">₺ Lira</button>
              <button class="cur-btn" data-cur="£" onclick="selectCur(this)">£ Sterlin</button>
              <button class="cur-btn" data-cur="¥" onclick="selectCur(this)">¥ Yen</button>
            </div>
          </div>
        </div>
      </div>
        <div class="field-row cols-2">
          <div><label class="field-label">Üst yazı</label><input class="admin-input" id="a-eyebrow"></div>
          <div><label class="field-label">Alt yazı</label><input class="admin-input" id="a-heroSub"></div>
        </div>
      </div>
      <div class="admin-group">
        <div class="admin-group-title">Navigasyon Başlıkları</div>
        <div class="field-row cols-3">
          <div><label class="field-label">Bölüm 1</label><input class="admin-input" id="a-nav0"></div>
          <div><label class="field-label">Bölüm 2</label><input class="admin-input" id="a-nav1"></div>
          <div><label class="field-label">Bölüm 3</label><input class="admin-input" id="a-nav2"></div>
        </div>
        <div class="field-row cols-3">
          <div><label class="field-label">Bölüm 4</label><input class="admin-input" id="a-nav3"></div>
          <div><label class="field-label">Bölüm 5</label><input class="admin-input" id="a-nav4"></div>
          <div><label class="field-label">Bölüm 6</label><input class="admin-input" id="a-nav5"></div>
        </div>
      </div>
      <div class="admin-group">
        <div class="admin-group-title">Bölüm Başlıkları</div>
        <div class="field-row cols-2">
          <div><label class="field-label">Tadım Menüsü — Üst etiket</label><input class="admin-input" id="a-deguLabel"></div>
          <div><label class="field-label">Tadım Menüsü — Başlık</label><input class="admin-input" id="a-deguTitle"></div>
        </div>
        <div class="field-row cols-2">
          <div><label class="field-label">Başlangıçlar — Üst etiket</label><input class="admin-input" id="a-antipastiLabel"></div>
          <div><label class="field-label">Başlangıçlar — Başlık</label><input class="admin-input" id="a-antipastiTitle"></div>
        </div>
        <div class="field-row cols-2">
          <div><label class="field-label">Birinci Yemekler — Üst etiket</label><input class="admin-input" id="a-primiLabel"></div>
          <div><label class="field-label">Birinci Yemekler — Başlık</label><input class="admin-input" id="a-primiTitle"></div>
        </div>
        <div class="field-row cols-2">
          <div><label class="field-label">Ana Yemekler — Üst etiket</label><input class="admin-input" id="a-secondiLabel"></div>
          <div><label class="field-label">Ana Yemekler — Başlık</label><input class="admin-input" id="a-secondiTitle"></div>
        </div>
        <div class="field-row cols-2">
          <div><label class="field-label">Tatlılar — Üst etiket</label><input class="admin-input" id="a-dolciLabel"></div>
          <div><label class="field-label">Tatlılar — Başlık</label><input class="admin-input" id="a-dolciTitle"></div>
        </div>
        <div class="field-row cols-2">
          <div><label class="field-label">Şaraplar — Üst etiket</label><input class="admin-input" id="a-viniLabel"></div>
          <div><label class="field-label">Şaraplar — Başlık</label><input class="admin-input" id="a-viniTitle"></div>
        </div>
      </div>
      <div class="admin-group">
        <div class="admin-group-title">Footer — Restoran Bilgileri</div>
        <div class="field-row">
          <div><label class="field-label">Footer Logo Adı</label><input class="admin-input" id="a-footerLogo"></div>
        </div>
        <div class="field-row">
          <div><label class="field-label">Adres & İletişim (HTML kabul edilir, &lt;br&gt; ile satır atla)</label><textarea class="admin-textarea" id="a-footerAddr" style="min-height:90px"></textarea></div>
        </div>
      </div>
    </div>

    <!-- TAB: DEGU -->
    <div class="admin-section" id="tab-degu">
      <div class="admin-group">
        <div class="admin-group-title">Tadım Menüsü — Genel Bilgiler</div>
        <div class="field-row cols-2">
          <div><label class="field-label">Rozet yazısı</label><input class="admin-input" id="a-deguBadge"></div>
          <div><label class="field-label">Menü adı</label><input class="admin-input" id="a-deguName"></div>
        </div>
        <div class="field-row cols-2">
          <div><label class="field-label">Alt başlık (porsiyon sayısı vb.)</label><input class="admin-input" id="a-deguSub"></div>
          <div><label class="field-label">Şarap eşleştirme butonu</label><input class="admin-input" id="a-pairingBtn"></div>
        </div>
        <div class="field-row">
          <div><label class="field-label">Fiyat (€)</label><input class="admin-input" id="a-deguPrice" style="max-width:160px"></div>
        </div>
      </div>
      <div class="admin-group">
        <div class="admin-group-title">Kurslar (Servis Sırası)</div>
        <div id="a-courses"></div>
        <button class="btn-add" onclick="addCourse()">+ Kurs Ekle</button>
      </div>
    </div>

    <!-- TAB: GÖRÜNÜM -->
    <div class="admin-section" id="tab-gorunum">

      <div class="admin-group">
        <div class="admin-group-title">Duyuru Bandı</div>
        <div class="toggle-row">
          <div><div class="toggle-label">Duyuru bandını göster</div><div class="toggle-desc">Navigasyon barının hemen altında görünür</div></div>
          <label class="toggle-switch"><input type="checkbox" id="t-bannerActive"><span class="toggle-slider"></span></label>
        </div>
        <div class="field-row" style="margin-top:12px">
          <div><label class="field-label">Duyuru metni</label><textarea class="admin-textarea" id="a-bannerText" style="min-height:56px"></textarea></div>
        </div>
      </div>

      <div class="admin-group">
        <div class="admin-group-title">Rezervasyon Butonu</div>
        <div class="toggle-row">
          <div><div class="toggle-label">Rezervasyon butonunu göster</div><div class="toggle-desc">Sol altta sabit buton</div></div>
          <label class="toggle-switch"><input type="checkbox" id="t-reservationActive"><span class="toggle-slider"></span></label>
        </div>
        <div class="field-row cols-2" style="margin-top:12px">
          <div><label class="field-label">Buton yazısı</label><input class="admin-input" id="a-reservationLabel"></div>
          <div><label class="field-label">Link (WhatsApp, URL vb.)</label><input class="admin-input" id="a-reservationLink" placeholder="https://wa.me/90..."></div>
        </div>
      </div>

      <div class="admin-group">
        <div class="admin-group-title">Sosyal Medya</div>
        <div class="field-row cols-2">
          <div><label class="field-label">Instagram URL</label><input class="admin-input" id="a-socialInstagram" placeholder="https://instagram.com/..."></div>
          <div><label class="field-label">Facebook URL</label><input class="admin-input" id="a-socialFacebook" placeholder="https://facebook.com/..."></div>
        </div>
      </div>

      <div class="admin-group">
        <div class="admin-group-title">Menü Bilgi Gösterimi</div>
        <div class="toggle-row">
          <div><div class="toggle-label">Şefin önerisi rozeti</div><div class="toggle-desc">★ işareti yemeklerin üzerinde görünür</div></div>
          <label class="toggle-switch"><input type="checkbox" id="t-showChefBadge"><span class="toggle-slider"></span></label>
        </div>
        <div class="toggle-row">
          <div><div class="toggle-label">Vejetaryen / Vegan ikonları</div><div class="toggle-desc">V ve VG rozetleri</div></div>
          <label class="toggle-switch"><input type="checkbox" id="t-showVeganIcons"><span class="toggle-slider"></span></label>
        </div>
        <div class="toggle-row">
          <div><div class="toggle-label">Alerjen bilgisi</div><div class="toggle-desc">Her yemeğin altında alerjen listesi</div></div>
          <label class="toggle-switch"><input type="checkbox" id="t-showAllergens"><span class="toggle-slider"></span></label>
        </div>
        <div class="toggle-row">
          <div><div class="toggle-label">Kalori bilgisi</div><div class="toggle-desc">Kcal değeri girilmişse gösterilir</div></div>
          <label class="toggle-switch"><input type="checkbox" id="t-showCalories"><span class="toggle-slider"></span></label>
        </div>
      </div>

    </div>

    <!-- TAB: ANTIPASTI -->
    <div class="admin-section" id="tab-antipasti">
      <div class="admin-group">
        <div class="admin-group-title">Başlangıç Yemekleri</div>
        <div id="a-antipasti-items"></div>
        <button class="btn-add" onclick="addItem('antipasti')">+ Yemek Ekle</button>
      </div>
    </div>

    <!-- TAB: PRIMI -->
    <div class="admin-section" id="tab-primi">
      <div class="admin-group">
        <div class="admin-group-title">Birinci Yemekler</div>
        <div id="a-primi-items"></div>
        <button class="btn-add" onclick="addItem('primi')">+ Yemek Ekle</button>
      </div>
    </div>

    <!-- TAB: SECONDI -->
    <div class="admin-section" id="tab-secondi">
      <div class="admin-group">
        <div class="admin-group-title">Ana Yemekler</div>
        <div id="a-secondi-items"></div>
        <button class="btn-add" onclick="addItem('secondi')">+ Yemek Ekle</button>
      </div>
    </div>

    <!-- TAB: DOLCI -->
    <div class="admin-section" id="tab-dolci">
      <div class="admin-group">
        <div class="admin-group-title">Tatlılar</div>
        <div id="a-dolci-items"></div>
        <button class="btn-add" onclick="addItem('dolci')">+ Yemek Ekle</button>
      </div>
    </div>

    <!-- TAB: VINI -->
    <div class="admin-section" id="tab-vini">
      <div id="a-wine-cats"></div>
      <button class="btn-add" onclick="addWineCategory()">+ Kategori Ekle</button>
    </div>

  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">Değişiklikler kaydedildi</div>

<script>
// ══════════════════════════════════════════════
// DATA
// ══════════════════════════════════════════════
// Şifre SHA-256 hash olarak saklanıyor (güvenli)
const ADMIN_HASH = '9ec81c2c9da131519d55f95fb5a4c5d5946bd038a6fbdccba4add2e301fdaeeb';

async function hashPassword(pw) {
  const encoder = new TextEncoder();
  const data = encoder.encode(pw + 'essenza_salt_2024');
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// Veriler menu-data.js'den geliyor
const defaultData = (typeof MENU_DATA !== 'undefined') ? MENU_DATA : {};

function loadData() {
  try { const s=localStorage.getItem('essenzaData'); return s ? JSON.parse(s) : JSON.parse(JSON.stringify(defaultData)); }
  catch(e){ return JSON.parse(JSON.stringify(defaultData)); }
}

let D = loadData();

// ══════════════════════════════════════════════
// RENDER MENU
// ══════════════════════════════════════════════
function renderMenu() {
  setText('d-eyebrow', D.eyebrow);
  setText('d-heroSub', D.heroSub);
  setText('d-deguLabel', D.deguLabel); setText('d-deguTitle', D.deguTitle);
  setText('d-antipastiLabel', D.antipastiLabel); setText('d-antipastiTitle', D.antipastiTitle);
  setText('d-primiLabel', D.primiLabel); setText('d-primiTitle', D.primiTitle);
  setText('d-secondiLabel', D.secondiLabel); setText('d-secondiTitle', D.secondiTitle);
  setText('d-dolciLabel', D.dolciLabel); setText('d-dolciTitle', D.dolciTitle);
  setText('d-viniLabel', D.viniLabel); setText('d-viniTitle', D.viniTitle);
  // Banner
  const banner = document.getElementById('siteBanner');
  setText('d-bannerText', D.bannerText || '');
  banner.classList.toggle('active', !!D.bannerActive);

  // Rezervasyon
  const resBtn = document.getElementById('reservationBtn');
  resBtn.textContent = D.reservationLabel || 'Rezervasyon';
  resBtn.classList.toggle('active', !!D.reservationActive);

  // Sosyal medya footer
  let socialHtml = '';
  if(D.socialInstagram) socialHtml += `<a href="${esc(D.socialInstagram)}" class="footer-social-link" target="_blank">Instagram</a>`;
  if(D.socialFacebook)  socialHtml += `<a href="${esc(D.socialFacebook)}" class="footer-social-link" target="_blank">Facebook</a>`;
  const socialEl = document.getElementById('d-socials');
  if(socialEl) socialEl.innerHTML = socialHtml;

  setText('d-footerLogo', D.footerLogo);
  setHtml('d-footerAddr', D.footerAddr);

  // Currency
  const cur = D.currency || '€';
  document.querySelectorAll('.item-price').forEach(el => {
    el.textContent = cur + el.textContent.replace(/^[€$₺£¥]/, '');
  });
  setText('d-deguCur', cur);
  setText('d-deguBadge', D.deguBadge);
  setText('d-deguName', D.deguName);
  setText('d-deguSub', D.deguSub);
  setText('d-deguPrice', D.deguPrice);
  setText('d-deguCur', D.currency || '€');
  const pb = document.getElementById('d-pairingBtn');
  if(pb){ pb.textContent = D.pairingBtn; pb.onclick = openPairing; }

  // NAV
  const navInner = document.getElementById('d-navInner');
  navInner.innerHTML = '';
  D.navLabels.forEach((label, i) => {
    const sections = ['degu','antipasti','primi','secondi','dolci','vini'];
    if(i>0) navInner.insertAdjacentHTML('beforeend','<span class="nav-dot">◆</span>');
    navInner.insertAdjacentHTML('beforeend',`<button class="nav-btn${i===0?' active':''}" onclick="scrollTo('${sections[i]}')">${label}</button>`);
  });

  // COURSES
  const cc = document.getElementById('d-courses');
  cc.innerHTML = D.courses.map(c=>`
    <div class="degu-course">
      <div class="course-num">${esc(c.num)}</div>
      <div class="course-info">
        <div class="course-name">${esc(c.name)}</div>
        <div class="course-desc">${esc(c.desc)}</div>
      </div>
    </div>`).join('');

  // MENU SECTIONS
  ['antipasti','primi','secondi','dolci'].forEach(sec=>{
    const secCur = D.currency || '€';
    document.getElementById('d-'+sec).innerHTML = D[sec]
      .filter(item => !item.hidden)
      .map(item=>`
      <div class="menu-item">
        <div>
          <div class="item-name">
            ${esc(item.name)}${item.sub?` <em>${esc(item.sub)}</em>`:''}
            ${D.showChefBadge && item.chefPick ? '<span class="badge-chef">★ Şef</span>' : ''}
            ${D.showVeganIcons && item.vegetarian && !item.vegan ? '<span class="badge-v" title="Vejetaryen">V</span>' : ''}
            ${D.showVeganIcons && item.vegan ? '<span class="badge-vg" title="Vegan">VG</span>' : ''}
          </div>
          <div class="item-desc">${esc(item.desc)}</div>
          ${item.tags ? `<div class="item-tags">${item.tags.split(',').map(t=>`<span class="tag">${esc(t.trim())}</span>`).join('')}</div>` : ''}
          ${D.showCalories && item.calories ? `<div class="item-calories">${esc(item.calories)} kcal</div>` : ''}
          ${D.showAllergens && item.allergens ? `<div class="item-allergens"><span class="item-allergen-label">Alerjenler:</span>${esc(item.allergens)}</div>` : ''}
        </div>
        <div class="item-price">${esc(item.price)}</div>
      </div>`).join('');
  });

  // VINI
  const wineCur = D.currency || '€';
  document.getElementById('d-vini').innerHTML = D.wineCats.map(cat=>`
    <div class="wine-category">
      <div class="wine-cat-title">${esc(cat.title)}</div>
      ${cat.wines.map(w=>`
        <div class="wine-item">
          <div><div class="wine-name">${esc(w.name)}</div><div class="wine-info">${esc(w.info)}</div></div>
          <div class="wine-prices">
            ${w.glass?`<div class="glass">Kadeh ${esc(w.glass)}</div>`:''}
            <div class="bottle">Şişe ${esc(w.bottle)}</div>
          </div>
        </div>`).join('')}
    </div>`).join('');
}

function setText(id,v){ const el=document.getElementById(id); if(el) el.textContent=v||''; }
function setHtml(id,v){ const el=document.getElementById(id); if(el) el.innerHTML=v||''; }
function esc(s){ if(!s)return''; const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }

// ══════════════════════════════════════════════
// AUTH
// ══════════════════════════════════════════════
function openLogin(){ document.getElementById('loginModal').classList.add('open'); setTimeout(()=>document.getElementById('pwInput').focus(),100); }
function closeLogin(){ document.getElementById('loginModal').classList.remove('open'); document.getElementById('pwInput').value=''; document.getElementById('pwError').textContent=''; }
async function checkPw(){
  const v = document.getElementById('pwInput').value;
  const hashed = await hashPassword(v);
  if(hashed === ADMIN_HASH){ closeLogin(); openAdmin(); }
  else { document.getElementById('pwError').textContent='Şifre hatalı, lütfen tekrar deneyin.'; document.getElementById('pwInput').select(); }
}

// ══════════════════════════════════════════════
// ADMIN PANEL
// ══════════════════════════════════════════════
function openAdmin(){
  fillAdminFields();
  document.getElementById('adminPanel').classList.add('open');
}
function closeAdmin(){ document.getElementById('adminPanel').classList.remove('open'); }

function fillAdminFields(){
  val('a-eyebrow', D.eyebrow); val('a-heroSub', D.heroSub);
  D.navLabels.forEach((l,i)=>val('a-nav'+i,l));
  // Currency buttons
  const cur = D.currency || '€';
  document.querySelectorAll('.cur-btn').forEach(btn=>{
    btn.classList.toggle('selected', btn.dataset.cur === cur);
  });
  // Görünüm tab
  const setChk = (id, val) => { const el=document.getElementById(id); if(el) el.checked=!!val; };
  setChk('t-bannerActive', D.bannerActive);
  setChk('t-reservationActive', D.reservationActive);
  setChk('t-showChefBadge', D.showChefBadge);
  setChk('t-showVeganIcons', D.showVeganIcons);
  setChk('t-showAllergens', D.showAllergens);
  setChk('t-showCalories', D.showCalories);
  val('a-bannerText', D.bannerText || '');
  val('a-reservationLabel', D.reservationLabel || 'Rezervasyon');
  val('a-reservationLink', D.reservationLink || '');
  val('a-socialInstagram', D.socialInstagram || '');
  val('a-socialFacebook', D.socialFacebook || '');
  val('a-deguLabel',D.deguLabel); val('a-deguTitle',D.deguTitle);
  val('a-antipastiLabel',D.antipastiLabel); val('a-antipastiTitle',D.antipastiTitle);
  val('a-primiLabel',D.primiLabel); val('a-primiTitle',D.primiTitle);
  val('a-secondiLabel',D.secondiLabel); val('a-secondiTitle',D.secondiTitle);
  val('a-dolciLabel',D.dolciLabel); val('a-dolciTitle',D.dolciTitle);
  val('a-viniLabel',D.viniLabel); val('a-viniTitle',D.viniTitle);
  val('a-footerLogo',D.footerLogo); val('a-footerAddr',D.footerAddr);
  val('a-deguBadge',D.deguBadge); val('a-deguName',D.deguName);
  val('a-deguSub',D.deguSub); val('a-deguPrice',D.deguPrice); val('a-pairingBtn',D.pairingBtn);
  renderCourseAdmin(); renderItemAdmin('antipasti'); renderItemAdmin('primi'); renderItemAdmin('secondi'); renderItemAdmin('dolci'); renderWineCatsAdmin();
}

function val(id,v){ const el=document.getElementById(id); if(el) el.value=v||''; }
function gval(id){ const el=document.getElementById(id); return el?el.value:''; }

function switchTab(tabId){
  document.querySelectorAll('.admin-section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.admin-tab').forEach(b=>b.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  event.target.classList.add('active');
}

// COURSES
function renderCourseAdmin(){
  const c = document.getElementById('a-courses');
  c.innerHTML = D.courses.map((course,i)=>`
    <div class="admin-card" id="course-card-${i}">
      <div class="admin-card-header">
        <span class="admin-card-num">Kurs ${i+1}</span>
        <div class="admin-card-actions"><button class="btn-del" onclick="delCourse(${i})">Sil</button></div>
      </div>
      <div class="field-row cols-3">
        <div><label class="field-label">Numara (Romen)</label><input class="admin-input" id="c-num-${i}" value="${esc(course.num)}"></div>
        <div style="grid-column:span 2"><label class="field-label">Yemek Adı</label><input class="admin-input" id="c-name-${i}" value="${esc(course.name)}"></div>
      </div>
      <div class="field-row"><div><label class="field-label">Açıklama</label><textarea class="admin-textarea" id="c-desc-${i}">${esc(course.desc)}</textarea></div></div>
    </div>`).join('');
}

function addCourse(){
  D.courses.push({num:'IX',name:'Yeni Kurs',desc:''});
  renderCourseAdmin();
}
function delCourse(i){ D.courses.splice(i,1); renderCourseAdmin(); }

function collectCourses(){
  D.courses = D.courses.map((_,i)=>({ num:gval('c-num-'+i), name:gval('c-name-'+i), desc:gval('c-desc-'+i) }));
}

// MENU ITEMS
function renderItemAdmin(sec){
  const c = document.getElementById('a-'+sec+'-items');
  c.innerHTML = D[sec].map((item,i)=>`
    <div class="admin-card" style="${item.hidden?'opacity:.5':''}">
      <div class="admin-card-header">
        <span class="admin-card-num">Yemek ${i+1}${item.hidden?' · GİZLİ':''}</span>
        <div class="admin-card-actions">
          <button class="btn-del" style="border-color:rgba(193,160,98,0.3);color:var(--gold-dim)" onclick="toggleHideItem('${sec}',${i})">${item.hidden?'Göster':'Gizle'}</button>
          <button class="btn-del" onclick="delItem('${sec}',${i})">Sil</button>
        </div>
      </div>
      <div class="field-row cols-3">
        <div style="grid-column:span 2"><label class="field-label">Yemek Adı</label><input class="admin-input" id="${sec}-name-${i}" value="${esc(item.name)}"></div>
        <div><label class="field-label">İtalik ek ad</label><input class="admin-input" id="${sec}-sub-${i}" value="${esc(item.sub||'')}"></div>
      </div>
      <div class="field-row"><div><label class="field-label">Açıklama</label><textarea class="admin-textarea" id="${sec}-desc-${i}">${esc(item.desc)}</textarea></div></div>
      <div class="field-row cols-2">
        <div><label class="field-label">Etiketler (virgülle ayır)</label><input class="admin-input" id="${sec}-tags-${i}" value="${esc(item.tags||'')}"></div>
        <div><label class="field-label">Fiyat</label><input class="admin-input" id="${sec}-price-${i}" value="${esc(item.price)}"></div>
      </div>
      <div class="field-row cols-2">
        <div><label class="field-label">Alerjenler</label><input class="admin-input" id="${sec}-allergens-${i}" value="${esc(item.allergens||'')}" placeholder="Gluten, Süt, Yumurta..."></div>
        <div><label class="field-label">Kalori (kcal)</label><input class="admin-input" id="${sec}-calories-${i}" value="${esc(item.calories||'')}" placeholder="420"></div>
      </div>
      <div style="display:flex;gap:20px;padding-top:8px;flex-wrap:wrap">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:12px;color:var(--muted)">
          <input type="checkbox" id="${sec}-chefPick-${i}" ${item.chefPick?'checked':''} style="accent-color:var(--gold)"> Şefin önerisi
        </label>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:12px;color:var(--muted)">
          <input type="checkbox" id="${sec}-vegetarian-${i}" ${item.vegetarian?'checked':''} style="accent-color:var(--gold)"> Vejetaryen
        </label>
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:12px;color:var(--muted)">
          <input type="checkbox" id="${sec}-vegan-${i}" ${item.vegan?'checked':''} style="accent-color:var(--gold)"> Vegan
        </label>
      </div>
    </div>`).join('');
}

function addItem(sec){
  D[sec].push({name:'Yeni Yemek',sub:'',desc:'',tags:'',price:'0'});
  renderItemAdmin(sec);
}
function delItem(sec,i){ D[sec].splice(i,1); renderItemAdmin(sec); }

function collectItems(sec){
  D[sec] = D[sec].map((_,i)=>({
    name:gval(sec+'-name-'+i), sub:gval(sec+'-sub-'+i),
    desc:gval(sec+'-desc-'+i), tags:gval(sec+'-tags-'+i),
    price:gval(sec+'-price-'+i), allergens:gval(sec+'-allergens-'+i),
    calories:gval(sec+'-calories-'+i),
    hidden: D[sec][i].hidden || false,
    chefPick: document.getElementById(sec+'-chefPick-'+i)?.checked || false,
    vegetarian: document.getElementById(sec+'-vegetarian-'+i)?.checked || false,
    vegan: document.getElementById(sec+'-vegan-'+i)?.checked || false,
  }));
}

function toggleHideItem(sec, i){
  D[sec][i].hidden = !D[sec][i].hidden;
  renderItemAdmin(sec);
}

// WINE CATS
function renderWineCatsAdmin(){
  const c = document.getElementById('a-wine-cats');
  c.innerHTML = D.wineCats.map((cat,ci)=>`
    <div class="admin-card" style="margin-bottom:24px">
      <div class="admin-card-header">
        <span class="admin-card-num">Kategori ${ci+1}</span>
        <div class="admin-card-actions"><button class="btn-del" onclick="delWineCat(${ci})">Kategoriyi Sil</button></div>
      </div>
      <div class="field-row"><div><label class="field-label">Kategori Başlığı</label><input class="admin-input" id="wcat-title-${ci}" value="${esc(cat.title)}"></div></div>
      <div id="a-wines-${ci}">
        ${cat.wines.map((w,wi)=>`
          <div class="admin-card" style="margin-top:12px;background:rgba(255,255,255,0.02)">
            <div class="admin-card-header">
              <span class="admin-card-num">Şarap ${wi+1}</span>
              <button class="btn-del" onclick="delWine(${ci},${wi})">Sil</button>
            </div>
            <div class="field-row"><div><label class="field-label">Şarap Adı</label><input class="admin-input" id="w-name-${ci}-${wi}" value="${esc(w.name)}"></div></div>
            <div class="field-row"><div><label class="field-label">Bilgi (bölge, üretici, yıl)</label><input class="admin-input" id="w-info-${ci}-${wi}" value="${esc(w.info)}"></div></div>
            <div class="field-row cols-2">
              <div><label class="field-label">Kadeh Fiyatı €</label><input class="admin-input" id="w-glass-${ci}-${wi}" value="${esc(w.glass)}"></div>
              <div><label class="field-label">Şişe Fiyatı €</label><input class="admin-input" id="w-bottle-${ci}-${wi}" value="${esc(w.bottle)}"></div>
            </div>
          </div>`).join('')}
      </div>
      <button class="btn-add" style="margin-top:8px" onclick="addWine(${ci})">+ Şarap Ekle</button>
    </div>`).join('');
}

function addWineCategory(){ D.wineCats.push({title:'Yeni Kategori',wines:[]}); renderWineCatsAdmin(); }
function delWineCat(ci){ D.wineCats.splice(ci,1); renderWineCatsAdmin(); }
function addWine(ci){ D.wineCats[ci].wines.push({name:'',info:'',glass:'',bottle:''}); renderWineCatsAdmin(); }
function delWine(ci,wi){ D.wineCats[ci].wines.splice(wi,1); renderWineCatsAdmin(); }

function collectWines(){
  D.wineCats = D.wineCats.map((cat,ci)=>({
    title: gval('wcat-title-'+ci),
    wines: cat.wines.map((_,wi)=>({ name:gval(`w-name-${ci}-${wi}`), info:gval(`w-info-${ci}-${wi}`), glass:gval(`w-glass-${ci}-${wi}`), bottle:gval(`w-bottle-${ci}-${wi}`) }))
  }));
}

function downloadFile(){
  saveAll();
  document.getElementById('adminPanel').classList.remove('open');
  showToast('İndiriliyor...');

  // Cache bypass — her seferinde taze kaynak çek
  const url = window.location.href.split('?')[0] + '?v=' + Date.now();
  fetch(url, { cache: 'no-store' })
    .then(r => r.text())
    .then(src => bakeAndDownload(src))
    .catch(() => showToast('Hata oluştu, tekrar deneyin'));
}

function bakeAndDownload(src){
  // 1. Eski baked-data ve eski inline intro script'lerini temizle
  src = src.replace(/<script id="baked-data">[\s\S]*?<\/script>\s*/g, '');
  src = src.replace(/<script id="intro-dismiss">[\s\S]*?<\/script>\s*/g, '');

  // 2. defaultData bloğunu D'nin güncel haliyle değiştir
  const MARKER = 'const defaultData = {';
  const start = src.indexOf(MARKER);
  if(start === -1){ showToast('Hata: kaynak bulunamadı'); return; }

  let depth = 0, pos = start;
  while(pos < src.length){
    const ch = src[pos];
    if(ch === '{') depth++;
    else if(ch === '}') { depth--; if(depth === 0){ pos++; break; } }
    pos++;
  }
  if(src[pos] === ';') pos++;

  const newBlock = 'const defaultData = ' + JSON.stringify(D, null, 2) + ';';
  src = src.slice(0, start) + newBlock + src.slice(pos);

  // 3. Intro dismiss script'ini her zaman zorla ekle — eski/yeni versiyondan bağımsız
  const introScript = `<script id="intro-dismiss">
(function(){
  function dismissIntro(){
    var el=document.getElementById('introScreen');
    if(!el||!el.parentNode)return;
    el.classList.add('hide');
    setTimeout(function(){if(el.parentNode)el.remove();},1000);
  }
  setTimeout(dismissIntro,2400);
  setTimeout(dismissIntro,5000);
  document.addEventListener('DOMContentLoaded',function(){
    var el=document.getElementById('introScreen');
    if(el)el.addEventListener('click',dismissIntro);
  });
})();
<\/script>`;

  // introScreen div'inin hemen ardına ekle
  src = src.replace(
    /(<div class="intro"[^>]*>[\s\S]*?<\/div>\s*)\n/,
    '$1\n' + introScript + '\n'
  );

  // 4. İndir
  const blob = new Blob([src], { type: 'text/html;charset=utf-8' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href = url;
  a.download = 'essenza-menu.html';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showToast('Dosya indirildi ✓');
}

function openReservation(){
  const link = D.reservationLink || '#';
  window.open(link, '_blank');
}

function selectCur(btn){
  document.querySelectorAll('.cur-btn').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  D.currency = btn.dataset.cur;
}

// SAVE ALL
function saveAll(){
  // Generale
  D.eyebrow = gval('a-eyebrow'); D.heroSub = gval('a-heroSub');
  D.navLabels = [0,1,2,3,4,5].map(i=>gval('a-nav'+i));
  D.deguLabel=gval('a-deguLabel'); D.deguTitle=gval('a-deguTitle');
  D.antipastiLabel=gval('a-antipastiLabel'); D.antipastiTitle=gval('a-antipastiTitle');
  D.primiLabel=gval('a-primiLabel'); D.primiTitle=gval('a-primiTitle');
  D.secondiLabel=gval('a-secondiLabel'); D.secondiTitle=gval('a-secondiTitle');
  D.dolciLabel=gval('a-dolciLabel'); D.dolciTitle=gval('a-dolciTitle');
  D.viniLabel=gval('a-viniLabel'); D.viniTitle=gval('a-viniTitle');
  D.footerLogo=gval('a-footerLogo'); D.footerAddr=gval('a-footerAddr');
  D.deguBadge=gval('a-deguBadge'); D.deguName=gval('a-deguName');
  D.deguSub=gval('a-deguSub'); D.deguPrice=gval('a-deguPrice'); D.pairingBtn=gval('a-pairingBtn');
  // Görünüm
  const getChk = id => document.getElementById(id)?.checked || false;
  D.bannerActive      = getChk('t-bannerActive');
  D.reservationActive = getChk('t-reservationActive');
  D.showChefBadge     = getChk('t-showChefBadge');
  D.showVeganIcons    = getChk('t-showVeganIcons');
  D.showAllergens     = getChk('t-showAllergens');
  D.showCalories      = getChk('t-showCalories');
  D.bannerText        = gval('a-bannerText');
  D.reservationLabel  = gval('a-reservationLabel');
  D.reservationLink   = gval('a-reservationLink');
  D.socialInstagram   = gval('a-socialInstagram');
  D.socialFacebook    = gval('a-socialFacebook');
  collectCourses(); collectItems('antipasti'); collectItems('primi'); collectItems('secondi'); collectItems('dolci'); collectWines();
  localStorage.setItem('essenzaData', JSON.stringify(D));
  renderMenu();
  showToast('Değişiklikler kaydedildi ✓');
}

function showToast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2800);
}

// ══════════════════════════════════════════════
// NAV SCROLL SPY
// ══════════════════════════════════════════════
function scrollToNav(){ document.getElementById('menu-nav').scrollIntoView({behavior:'smooth'}); }
function scrollTo(id){ const el=document.getElementById(id); if(el){ const top=el.getBoundingClientRect().top+window.scrollY-70; window.scrollTo({top,behavior:'smooth'}); } }

const sectionIds = ['degu','antipasti','primi','secondi','dolci','vini'];
const obs = new IntersectionObserver((entries)=>{
  entries.forEach(entry=>{
    if(entry.isIntersecting){
      entry.target.classList.add('visible');
      const id=entry.target.id, idx=sectionIds.indexOf(id);
      if(idx!==-1){ document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); const btns=document.querySelectorAll('.nav-btn'); if(btns[idx]) btns[idx].classList.add('active'); }
    }
  });
},{ threshold:0.12, rootMargin:'-60px 0px -20% 0px' });

document.querySelectorAll('.section').forEach(s=>obs.observe(s));

// ══════════════════════════════════════════════
// PAIRING
// ══════════════════════════════════════════════
function openPairing(){
  document.getElementById('pairingOverlay').classList.add('open');
  document.getElementById('pairingBody').innerHTML = `
    <div class="pairing-loading">
      <div class="pairing-spinner"></div>
      <div class="pairing-loading-text">Eşleştirmeler hazırlanıyor...</div>
    </div>`;
  fetchPairings();
}

function closePairing(){
  document.getElementById('pairingOverlay').classList.remove('open');
}

function fetchPairings(){
  // Sommelier bilgi tabanı — anahtar kelime → şarap profili eşleştirme
  const PAIRING_RULES = [
    // Köpüklü / hafif başlangıçlar
    { keywords:['istiridye','ostrica','kabuk','deniz','caviale','havyar','crudo','çiğ','karides','gambero','hamsi','ton'], wineProfile:'sparkling', reasons:[
      'Deniz ürünlerinin iyot ve mineral notaları köpüklü şarapların asidik yapısıyla mükemmel denge kuruyor.',
      'Kabukluların tuzlu deniz aroması, köpüklü şarabın ince balonlarıyla zarif bir uyum sağlıyor.',
      'Şampanyanın mineralli ve asidik karakteri bu hafif deniz lezzetini taze tutuyor.'
    ]},
    // Beyaz — balık / deniz
    { keywords:['balık','branzino','levrek','ricciola','salmone','sogliola','orata','calamari','polpo','ahtapot','ıstakoz'], wineProfile:'white_mineral', reasons:[
      'Balığın narin yapısı, beyaz şarabın mineral ve asidik notalarıyla harika bir armoni oluşturuyor.',
      'Bu deniz yemeğinin yumuşak dokusu, beyaz şarabın ferahlığıyla mükemmel eşleşiyor.',
      'Beyaz şarabın asidik karakteri balığın yağlılığını dengeleyen ideal bir tamamlayıcı.'
    ]},
    // Beyaz — krema / yumurta / pasta
    { keywords:['risotto','pasta','makarna','raviolo','tagliolini','spaghetti','uovo','yumurta','burro','tereyağ','parmigiano','parmesan','fonduta','fondü','trüf','tartufo'], wineProfile:'white_full', reasons:[
      'Yemekteki kremamsı doku ve zengin aromalar, tam gövdeli beyaz şarabın yağlı yapısıyla uyum içinde.',
      'Şarabın mineral notaları makarna ve risottodaki nişastalı yapıyı dengelerken lezzeti tamamlıyor.',
      'Bu zengin kursu hafifletmek için ferah asidiyetli bir beyaz ideal tercih.'
    ]},
    // Pembe — hafif et / kümes
    { keywords:['kümes','ördek','anatra','piccione','güvercin','quaglia','bıldırcın','animelle','uykuluk','prosciutto'], wineProfile:'rose_or_light_red', reasons:[
      'Kümes hayvanlarının yumuşak etli yapısı hem rosé hem de hafif kırmızı şaraplarla dengeleniyor.',
      'Bu yemeğin narin protein yapısı, çok ağır olmayan kırmızı şarapların meyveli tanenleriyle uyum sağlıyor.',
      'Ettin yağlılığı şarabın tanenli yapısıyla temizlenirken aromalar birbirini tamamlıyor.'
    ]},
    // Kırmızı — güçlü et
    { keywords:['manzo','dana','sığır','bistecca','biftek','wagyu','kontrfile','fiorentina','agnello','kuzu','cinghiale','yaban domuzu','selvaggina','av'], wineProfile:'red_full', reasons:[
      'Etin güçlü protein yapısı ve yağlılığı, Barolo\'nun ağır tanen yapısıyla mükemmel denge kuruyor.',
      'Bu zengin et yemeği, tam gövdeli kırmızıların kompleks meyve ve toprak notalarını en iyi şekilde ortaya çıkarıyor.',
      'Şarabın uzun bitiş süresi ve tanenleri etin yoğunluğunu dengeleyerek olağanüstü bir kombinasyon oluşturuyor.'
    ]},
    // Tatlı şarap
    { keywords:['dolce','tatlı','dessert','cioccolato','çikolata','tiramisù','tiramisu','panna cotta','gelato','dondurma','nocciola','fındık','caramello','karamel','soufflé','sufle','pasticceria'], wineProfile:'sweet', reasons:[
      'Tatlı şarabın bal ve kuru meyve notaları tatlının zengin lezzetini zarif biçimde tamamlıyor.',
      'Bu tatlının yoğun aroması, şarabın doğal tatlılığıyla aynı yoğunlukta buluşup mükemmel uyum sağlıyor.',
      'Şarabın asidiyeti tatlının şekerliğini dengeleyerek son kursu ferah bir notayla tamamlıyor.'
    ]},
    // Foie gras / zengin başlangıç
    { keywords:['foie','ciğer','terrine','burrata','carpaccio','prosciutto'], wineProfile:'white_full', reasons:[
      'Zengin ve yağlı yapı, beyaz şarabın asidiyeti ile dengeleniyor.',
      'Şarabın mineral notaları zengin başlangıcın ağırlığını hafifletiyor.',
      'Bu lüks başlangıç için şarabın karmaşık aromatik yapısı ideal eşlikçi.'
    ]},
  ];

  const WINE_PROFILES = {
    sparkling:     ['Şampanya', 'Köpüklü', 'Bollicine', 'Franciacorta', 'Prosecco', 'Cava', 'Crémant'],
    white_mineral: ['Vernaccia', 'Soave', 'Greco', 'Fiano', 'Vermentino', 'Pinot Grigio', 'Gavi', 'Sauvignon', 'Chablis', 'Riesling'],
    white_full:    ['Chardonnay', 'Gaia', 'Viognier', 'White Burgundy', 'Beyaz'],
    rose_or_light_red: ['Rosé', 'Rosato', 'Pinot Nero', 'Pinot Noir', 'Bardolino', 'Valpolicella'],
    red_full:      ['Barolo', 'Barbaresco', 'Brunello', 'Amarone', 'Sassicaia', 'Bolgheri', 'Chianti', 'Nebbiolo', 'Cabernet', 'Syrah', 'Primitivo', 'Montepulciano'],
    sweet:         ['Passito', 'Vin Santo', 'Moscato', 'Sauternes', 'Dessert', 'Tatlı', 'Recioto'],
  };

  // Tüm şarapları düz listeye çek
  const allWines = [];
  D.wineCats.forEach(cat => cat.wines.forEach(w => allWines.push(w)));

  // Her kurs için eşleştir
  const pairings = D.courses.map(course => {
    const text = (course.name + ' ' + course.desc).toLowerCase();

    // Hangi profile uyuyor?
    let matchedProfile = null;
    let matchedReasons = [];
    for(const rule of PAIRING_RULES){
      if(rule.keywords.some(kw => text.includes(kw))){
        matchedProfile = rule.wineProfile;
        matchedReasons = rule.reasons;
        break;
      }
    }

    // Amuse-bouche / pre-dessert özel durumlar
    if(!matchedProfile){
      if(text.includes('amuse') || text.includes('welcome') || text.includes('hoş geldin') || text.includes('bouchée')){
        matchedProfile = 'sparkling';
        matchedReasons = ['Karşılama servisinde köpüklü şarap hem damağı açıyor hem de geceye şık bir giriş yapıyor.'];
      } else if(text.includes('pre-dessert') || text.includes('ön tatlı') || text.includes('sorbetto') || text.includes('sorbesi') || text.includes('granita')){
        matchedProfile = 'sweet';
        matchedReasons = ['Ara temizleyici bu servis, hafif tatlı notalarla geçişi zarif kılıyor.'];
      } else {
        matchedProfile = 'white_full';
        matchedReasons = ['Bu kursun dengeli aroması, orta gövdeli bir beyaz şarapla zarif uyum sağlıyor.'];
      }
    }

    // Profildeki anahtar kelimelerle listedeki şarabı bul
    const profileKeywords = WINE_PROFILES[matchedProfile] || [];
    let bestWine = null;
    for(const kw of profileKeywords){
      bestWine = allWines.find(w => w.name.toLowerCase().includes(kw.toLowerCase()) || (w.info||'').toLowerCase().includes(kw.toLowerCase()));
      if(bestWine) break;
    }

    const reason = matchedReasons[Math.floor(Math.random() * matchedReasons.length)];

    if(bestWine){
      return { courseNum: course.num, courseName: course.name, wineName: bestWine.name, reason, isExternal: false };
    } else {
      // Listede uygun yok — genel öneri
      const generalSuggestions = {
        sparkling:     'Krug Grande Cuvée veya Billecart-Salmon Blanc de Blancs',
        white_mineral: 'Chablis Premier Cru veya Sancerre',
        white_full:    'Puligny-Montrachet veya Meursault',
        rose_or_light_red: 'Pinot Noir Burgundy veya Bandol Rosé',
        red_full:      'Barolo Bussia veya Bolgheri Superiore',
        sweet:         'Château d\'Yquem veya Vin Santo del Chianti',
      };
      return {
        courseNum: course.num,
        courseName: course.name,
        wineName: generalSuggestions[matchedProfile] || 'Sommelierimize danışın',
        reason: reason + ' Mevcut listemizde bu kursa en yakın alternatif için sommelierimize danışabilirsiniz.',
        isExternal: true
      };
    }
  });

  // Kısa bir gecikmeyle render et (loading animasyonu görünsün)
  setTimeout(() => renderPairings(pairings), 600);
}

function renderPairings(pairings){
  const html = `<div class="pairing-courses">
    ${pairings.map((p, i) => `
      <div class="pairing-course-card" style="animation-delay:${i * 0.08}s">
        <div class="pairing-course-header">
          <span class="pairing-course-num">${esc(p.courseNum)}</span>
          <span class="pairing-course-name">${esc(p.courseName)}</span>
        </div>
        <div class="pairing-wine-name">◆ ${esc(p.wineName)}</div>
        <div class="pairing-wine-reason">${esc(p.reason)}</div>
        ${p.isExternal ? `<div class="pairing-external-note">* Menü şarap listesi dışında öneri</div>` : ''}
      </div>`).join('')}
  </div>`;
  document.getElementById('pairingBody').innerHTML = html;
}

// Close pairing on overlay click
document.getElementById('pairingOverlay').addEventListener('click', function(e){
  if(e.target === this) closePairing();
});

// ══════════════════════════════════════════════
// INIT
// ══════════════════════════════════════════════
renderMenu();
</script>
</body>
</html>
